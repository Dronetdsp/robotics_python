import time
import numpy as np 
from collision import collision

class Parameters:
    
    def __init__(self):
        
        self.dof = 14
        
        # leg lengths, body width
        self.l0 = 1; self.l1 = 0.5; self.l2 = 0.5
        self.w = 0.1
        
        # mass and inertia
        self.mb = 70; self.mt = 10; self.mc = 5
        self.Ibx = 5; self.Iby = 3; self.Ibz = 2
        self.Itx = 1; self.Ity = 0.3; self.Itz = 2
        self.Icx = 0.5; self.Icy = 0.15; self.Icz = 1
        
        self.g = 9.8

        # total weight and height
        self.M = self.mb + 2*self.mt + 2*self.mc
        self.L = self.l1 + self.l2
        
        # misc other params
        self.stepAngle = 0.375 # #step length
        self.Impulse = 0.18 * self.M * np.sqrt(self.g * self.L) #push-off impulse
        self.kneeAngle = -1 #Knee bending to avoid scuffing
        self.Kp = 100 #gain for partial feedback linearization
        self.Kd = np.sqrt(self.Kp) 
        
        self.stance_foot_init = 'right'
        self.stance_foot = self.stance_foot_init
        
        self.fps = 10
        self.pause = 0.01

if __name__=="__main__":
    params = Parameters()
    t = 0.0
    z_in = np.array([
        -0.000049815000110,
        1.014525925343273,
        0.070715370139685,
        -0.001725772505528,
        0.999571112013753,
        0.000000000000035,
        0,
        0,
        0,
        0.000000000000001,
        -0.000000000000006,
        -0.000000000000003,
        0.000000000000006,
        0.000000000000043,
        -0.000000000000002,
        0.000000000000070,
        -0.000000000000013,
        -0.000000000000057,
        -0.999999999999981,
        0.000000000000061,
        -0.029247773468329,
        0.054577886084082,
        -0.001551040824746,
        -1.029460778006675,
        0.054690088280553,
        0.559306810759302,
        -0.000000000000001,
        -0.000000000000031
    ])
    # 1.845961928679959e-15
    
    z_in = np.array([
        0.366270095359199,
        1.38824916863229,
        0.0986647814206533,
        0.171840813500348,
        0.930507621912316,
        -0.546201555325112,
        2.80481658055819e-17,
        -9.46126314658545e-17,
        -3.75836199850739e-17,
        1.37283632218107e-15,
        1.16872492623600e-18,
        -1.92419603373729e-16,
        -3.54266391044869e-17,
        -1.94194936648633e-16,
        0.374999999999990,
        -3.93810101253212e-14,
        -4.92408714338543e-18,
        1.37256092154613e-17,
        3.33841613771528e-15,
        2.83615442704572e-14,
        0.0232351951689813,
        0.467333007616244,
        -0.374313477349478,
        -1.46660606237950,
        0.0627189311482995,
        0.448216486669311,
        -1.27039265465846e-16,
        -5.26825001455317e-15
    ], dtype=np.float64) # gstop = -1.5243951564533933e-16
    
    # z_in = np.array([
    #     0.359332503997798,
    #     1.37764221555951,
    #     0.0978094293940689,
    #     0.169169411403750,
    #     0.933207025783186,
    #     -0.530065715027025,
    #     2.15962834529561e-17,
    #     -1.19911421128157e-18,
    #     3.78386238997046e-17,
    #     3.10416639215064e-16,
    #     5.78024489882718e-18,
    #     -3.25869463241707e-16,
    #     -4.71328349575080e-17,
    #     -2.09886618509020e-17,
    #     0.374999999999990,
    #     -4.41867173696052e-14,
    #     -1.66397637141818e-17,
    #     2.35242809780179e-16,
    #     2.87099264382763e-15,
    #     3.31772376789721e-14,
    #     0.0209178502623251,
    #     0.456558310842384,
    #     -0.366990988085544,
    #     -1.45277005690179,
    #     0.0604546788918736,
    #     0.454465060127822,
    #     -4.58802960535946e-16,
    #     -2.26245814140979e-16
    # ]) # gstop = 0.0026994038708687412

    z_in = np.array([
        0.366270095359194,
        1.388249168632282,
        0.098664781420653,
        0.171840813500346,
        0.930507621912318,
        -0.546201555325101,
        0.000000000000000,
        -0.000000000000000,
        -0.000000000000000,
        0.000000000000001,
        0.000000000000000,
        -0.000000000000000,
        -0.000000000000000,
        -0.000000000000000,
        0.374999999999990,
        -0.000000000000039,
        -0.000000000000000,
        0.000000000000000,
        0.000000000000003,
        0.000000000000028,
        0.023235195168980,
        0.467333007616236,
        -0.374313477349473,
        -1.466606062379494,
        0.062718931148298,
        0.448216486669315,
        -0.000000000000000,
        -0.000000000000005
    ]) # gstop = 0.0026994038708687412

    z_in = np.array([ 
        4.37276782e-01,
        7.87470346e+00,
        1.14641367e-01,
        4.92336138e-01,
        8.99207834e-01,
        -3.83741467e+00,
        4.72893128e-18,
        -3.03877125e-16,
        -5.27220298e-16,
        -1.37719321e-14,
        3.64507575e-14,
        1.04128957e-12,
        -5.69134144e-14,
        -1.63400232e-12,
        2.55620369e+00,
        6.22474054e+01,
        1.04773726e-13,
        3.00331687e-12,
        5.81654319e+00,
        1.65993081e+02,
        -2.82547985e-02,
        4.11247775e+00,
        -4.52019497e-01,
        -9.02851319e+00,
        -9.15888438e-02,
        9.24791867e+00,
        2.17794211e-14,
        6.23527175e-13
    ])
    gstop = collision(t, z_in, params)
    print(f"gstop = {gstop}")
    # gstop
    #    0.229419959079676
    
    #    0.22941995907967566
    
    